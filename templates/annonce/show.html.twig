{% extends 'base.html.twig' %}

{% block body %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />



<div class="container my-5">
  <div class="row" style="display:flex" >
<h2 class="mb-3 text-primary fw-bold text-uppercase border-bottom pb-2">
    <i class="fas fa-bullhorn me-2"></i> Détails annonce : {{ annonce.titre }}
</h2>
          {% set nbImg = 0 %} 

    {% for image in images %}
     {% if annonce.id == image.annonce.id %}
         {% set nbImg = nbImg + 1 %} 
     {% endif %}
    {% endfor %}

   {% set nbIt = 0 %}
    <div class="col-md-6 mb-4">
    {% for image in images %}
    {% if annonce.id == image.annonce.id and nbIt < 1 %}
        <img id="mainImage" src="{{ asset('uploads/images/' ~ image.imageName) }}" alt="Annonce Image" class="img-fluid rounded shadow">
        {% set nbIt = nbIt + 1 %} 

    {% endif %}
    {% endfor %} 
    </div>
 


   {% if nbImg >= 2 %}
    <div class="col-md-5" style="margin-left:5%">
        <div class="row">
            {% for image in images %}
                {% if annonce.id == image.annonce.id %}
                    <div class="col-md-4 mb-3">
                        <img src="{{ asset('uploads/images/' ~ image.imageName) }}" alt="Thumbnail" class="img-thumbnail img-fluid" style="cursor: pointer;" onclick="changeMainImage('{{ asset('uploads/images/' ~ image.imageName) }}')">
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
  </div>

  <div class="row">
    <div class="col-md-12">
      <div id="map" class="mb-4 rounded shadow" style="height: 300px; width: 100%;"></div>

      <div class="alert alert-info mb-4">
        <h4 class="alert-heading">Disponibilité : {% if annonce.disponibilite == 1 %}Disponible{% else %}Indisponible{% endif %}</h4>
      </div>

      <div class="card mb-4 shadow">
        <div class="card-body">
          <h5 class="card-title"><strong>{{annonce.user.nom}} {{annonce.user.prenom}}</strong></h5>
          <a href="{{ path('app_annonce_show', {'id': annonce.id}) }}" class="btn btn-outline-primary btn-sm mb-2">
            Voir profil
          </a> </br>
          <div class="star-rating mb-3" style="--rating: 4;"></div>
          {% if app.user %}
          <a href="{{ path('app_annonce_show', {'id': annonce.id}) }}" class="btn btn-success btn-sm">
            <i class="fas fa-paper-plane"></i> Envoyer Offre
          </a></br> 
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-md-12">
      <h2 class="mb-3">Description :</h2>
      <p class="lead">{{ annonce.description }}</p>
      <div class="row">
        <div class="col-md-4">
          <div class="card mb-3 shadow">
            <div class="card-body">
              <strong>Région:</strong> {{ annonce.region }}
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card mb-3 shadow">
            <div class="card-body">
              <strong>Catégorie:</strong> {{ annonce.categorie.libelle }}
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card mb-3 shadow">
            <div class="card-body">
              <strong>Date Publication:</strong> {{ annonce.dateCreation|date('j M Y') }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% set anID = annonce.id %}
<div class="row mt-4">
    <div class="col-md-12">
        <h2>Dernières annonces publiées :</h2>
        <div class="d-flex overflow-auto">
            {% for annonce in annonces|slice(0,5) %} 
                {% if annonce.id != anID %} 
                    <div class="card mx-2" style="width: 18rem;">
                        {% if annonce.images is not empty %}
                            <img src="{{ asset('uploads/images/' ~ annonce.images.0.imageName) }}" class="card-img-top" alt="Image de l'annonce">
                        {% else %}
                            <img src="{{ asset('images/default.jpg') }}" class="card-img-top" alt="Image par défaut">
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">{{ annonce.titre }}</h5>
                            <p class="card-text">{{ annonce.description|slice(0, 100) }}...</p>
                            <small class="text-muted">Publié le {{ annonce.dateCreation|date('d F Y') }}</small>
                            <br>
                            <small class="text-muted">Catégorie: {{ annonce.categorie.libelle }}</small>
                            <br>
                            <a href="{{ path('app_annonce_show', {'id': annonce.id}) }}" class="btn btn-primary btn-sm mt-2">Voir Détails</a>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>


</div>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  var map = L.map('map').setView([36.8065, 10.1815], 12);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  var marker = L.marker([{{ annonce.x }}, {{ annonce.y }}])
    .addTo(map)
    .bindPopup("<b>{{ annonce.titre }}</b>")
    .openPopup();
});

function changeMainImage(newSrc) {
  document.getElementById('mainImage').src = newSrc;
}
</script>

<style>

      body {
            background-color: #f0fff4;
            font-family: 'Arial', sans-serif;
        }

.star-rating {
  --percent: calc(var(--rating) / 5 * 100%);
  display: inline-block;
  font-size: 24px;
  line-height: 1;
}

.star-rating::before {
  content: '★★★★★';
  letter-spacing: 2px;
  background: linear-gradient(90deg, 
    gold var(--percent), 
    lightgray var(--percent)
  );
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

.card {
  transition: transform 0.2s;
}

.card:hover {
  transform: translateY(-5px);
}

.shadow {
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.img-thumbnail {
  transition: transform 0.2s;
}

.img-thumbnail:hover {
  transform: scale(1.05);
}
</style>
{% endblock %}