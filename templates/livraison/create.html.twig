<h1>Cr√©er votre livraison</h1>

{{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}

{{ form_row(form.TelephoneExpediteur,  {'attr': {'value': app.user.tel}}) }}

{{ form_row(form.CodePostalExpediteur) }}
{{ form_row(form.localisation_expediteur_lat, {'attr': {'readonly': true}}) }}
{{ form_row(form.localisation_expediteur_lng, {'attr': {'readonly': true}}) }}
<button type="submit">Enregistrer</button>
{{ form_end(form) }}

<!-- Carte -->
<div id="map" style="width: 100%; height: 400px;"></div>

<!-- OpenLayers -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css">
<script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>

<div id="map" style="width: 100%; height: 400px;"></div>

<!-- OpenLayers -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css">
<script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>

<script>
	document.addEventListener("DOMContentLoaded", function () {
var lat = {{ livraison.localisationExpediteurLat|default(36.8065) }};
var lng = {{ livraison.localisationExpediteurLng|default(10.1815) }};

var map = new ol.Map({
target: 'map',
layers: [new ol.layer.Tile(
{source: new ol.source.OSM()}
)],
view: new ol.View(
{
center: ol.proj.fromLonLat(
[lng, lat]
),
zoom: 12
}
)
});

var marker = new ol.Feature({
geometry: new ol.geom.Point(ol.proj.fromLonLat([lng, lat]))
});

var vectorSource = new ol.source.Vector({features: [marker]});

var markerLayer = new ol.layer.Vector({
source: vectorSource,
style: new ol.style.Style(
{
image: new ol.style.Icon(
{
anchor: [
0.5, 1
],
src: 'https://openlayers.org/en/latest/examples/data/icon.png'
}
)
}
)
});

map.addLayer(markerLayer);

// üìç R√©cup√©rer la localisation actuelle
navigator.geolocation.getCurrentPosition(function (position) {
var newLat = position.coords.latitude;
var newLng = position.coords.longitude;

document.getElementById('livraison_localisation_expediteur_lat').value = newLat;
document.getElementById('livraison_localisation_expediteur_lng').value = newLng;

marker.setGeometry(new ol.geom.Point(ol.proj.fromLonLat([newLng, newLat])));
map.getView().setCenter(ol.proj.fromLonLat([newLng, newLat]));
map.getView().setZoom(15);
});

// üìå Permettre √† l'utilisateur de modifier sa position
map.on('click', function (event) {
var coords = ol.proj.toLonLat(event.coordinate);
var newLat = coords[1];
var newLng = coords[0];

document.getElementById('livraison_localisation_expediteur_lat').value = newLat;
document.getElementById('livraison_localisation_expediteur_lng').value = newLng;

marker.setGeometry(new ol.geom.Point(ol.proj.fromLonLat([newLng, newLat])));
});
});
</script>
