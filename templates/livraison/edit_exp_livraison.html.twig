<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Modifier Livraison</title>
	<!-- Ajouter OpenLayers -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css">
	<script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>


</head>
<style>
	#map {
		width: 100%;
		height: 400px;
	}
</style>



<form action="{{ path('livraison_edit_expediteur', {'id': livraison.id}) }}" method="post">
<h2>Modifier les informations de Livraison</h2>

<label for="telephone_expediteur">Téléphone :</label>
<input type="text" id="telephone_expediteur" name="telephone_expediteur" value="{{ livraison.telephoneExpediteur }}">

<label for="code_postal_expediteur">Code Postal :</label>
<input type="text" id="code_postal_expediteur" name="code_postal_expediteur" value="{{ livraison.codePostalExpediteur }}">

<input type="hidden" id="localisation_expediteur_lat" name="localisation_expediteur_lat" value="{{ livraison.localisationExpediteurLat }}">
<input type="hidden" id="localisation_expediteur_lng" name="localisation_expediteur_lng" value="{{ livraison.localisationExpediteurLng }}">

<button type="submit">Modifier Mes coordonnées</button>
</form>

<div id="map" style="width: 100%; height: 400px;"></div>

<script>
var lat = {{ livraison.localisationExpediteurLat|default(36.8065) }};
var lng = {{ livraison.localisationExpediteurLng|default(10.1815) }};

var map = new ol.Map({
    target: 'map',
    layers: [new ol.layer.Tile(
        {source: new ol.source.OSM()}
    )],
    view: new ol.View({
        center: ol.proj.fromLonLat([lng, lat]),
        zoom: 12
    })
});

var marker = new ol.Feature({
    geometry: new ol.geom.Point(ol.proj.fromLonLat([lng, lat]))
});

var vectorSource = new ol.source.Vector({features: [marker]});

var markerLayer = new ol.layer.Vector({
    source: vectorSource,
    style: new ol.style.Style({
        image: new ol.style.Icon({
            anchor: [0.5, 1],
            src: 'https://openlayers.org/en/latest/examples/data/icon.png'
        })
    })
});

map.addLayer(markerLayer);

map.on('click', function (event) {
    var coords = ol.proj.toLonLat(event.coordinate);
    var newLat = coords[1];
    var newLng = coords[0];

    marker.setGeometry(new ol.geom.Point(ol.proj.fromLonLat([newLng, newLat])));

    document.getElementById('localisation_expediteur_lat').value = newLat;
    document.getElementById('localisation_expediteur_lng').value = newLng;
});
</script>
